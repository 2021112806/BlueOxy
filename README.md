# 蓝牙数据接收应用

这是一个Android应用程序，用于通过蓝牙连接设备并接收实时数据。应用专注于氧浓度监测，支持数据实时显示、历史记录查询和可视化图表分析。

## 功能特点

- 扫描并显示附近的蓝牙设备
- 连接选定的蓝牙设备
- 接收并实时显示蓝牙设备发送的数据
- 存储历史数据以供查询
- 生成氧浓度数据的可视化图表（折线图、柱状图、饼图）
- 智能化数据分析与趋势判断
- 蓝牙连接状态监控与自动重连（最多3次）
- 未连接设备时的操作保护
- 优化的UI交互体验与视觉反馈

## 数据格式支持

应用支持处理以下格式的数据：
1. `Data1: [原始ADC值]` - 显示为ADC原始数值
2. `Data2: [氧浓度值]%` - 显示为氧浓度数值，同时在图表中可视化
3. `Data3: [电压值]V` - 显示为电压数值

## 技术栈

- 开发语言：Java
- 平台：Android
- 最低支持Android版本：Android 6.0 (API 级别 23)
- 蓝牙：Bluetooth Low Energy (BLE) 和传统蓝牙
- 图表库：MPAndroidChart

## 项目结构

- `app/src/main/java/com/example/blueteeth/`：包含应用的Java代码
  - `MainActivity.java`：主活动，用于扫描和连接蓝牙设备
  - `DataDisplayActivity.java`：数据显示活动，显示接收到的数据
  - `ChartActivity.java`：图表显示活动，将氧浓度数据绘制成折线图、柱状图和饼图
  - `HistoryActivity.java`：历史记录活动，显示和管理历史数据
  - `BluetoothService.java`：蓝牙后台服务，处理蓝牙连接和数据传输
  - `DataPoint.java`：数据点模型类，存储接收到的不同类型的数据
  - `DeviceListAdapter.java`：蓝牙设备列表适配器
  - `DataDBHelper.java`：数据库帮助类，管理数据的存储和检索
- `app/src/main/res/`：包含应用的资源文件
  - `layout/`：界面布局XML文件
  - `values/`：字符串、颜色等资源值

## 使用说明

1. 打开应用，点击主界面上的"扫描蓝牙"按钮
2. 从显示的设备列表中选择要连接的蓝牙设备
3. 成功连接后，点击"开始测量"按钮接收数据
   - 如果蓝牙未连接，应用会提示"蓝牙未连接，请先连接设备"
   - 如果蓝牙连接断开，应用会自动尝试重连（最多3次）
4. 数据将实时显示在屏幕上，应用会自动识别并分类显示不同类型的数据
5. 点击"查看历史"按钮查看存储的历史数据
6. 点击"查看图表"按钮查看氧浓度数据的可视化图表，包括：
   - 折线图：展示氧浓度变化趋势
   - 柱状图：展示氧浓度数据的分布情况
   - 饼图：展示氧浓度范围分布（低氧、正常低段、正常高段、高氧）

## 图表功能详解

图表页面提供三种不同类型的图表视图，专注于氧浓度数据的可视化：

1. **折线图**：直观展示氧浓度随时间的变化趋势，帮助用户识别氧浓度的波动模式
2. **柱状图**：以区间分布方式展示氧浓度数据，便于用户了解数据在不同浓度范围的分布情况
3. **饼图**：根据预设浓度范围（<16%、16-20%、20-23.5%、>23.5%）将数据分组，以百分比形式直观展示不同浓度范围的占比

每个图表下方均提供了一份数据分析摘要，包含平均值、最高值、最低值、低氧比例以及趋势判断。用户可通过页面顶部的下拉菜单切换不同图表类型，通过"刷新"按钮获取最新数据。

## 数据交互机制

应用采用高效的数据交互机制，确保各个界面间的数据同步与流转：

1. **实时数据接收**：BluetoothService负责接收蓝牙设备发送的数据，并通过Handler传递给DataDisplayActivity
2. **图表数据获取**：ChartActivity通过广播机制向DataDisplayActivity请求最新数据，无需再次请求蓝牙设备
3. **异步数据更新**：数据更新过程通过异步机制实现，并提供清晰的视觉反馈
4. **历史数据访问**：HistoryActivity通过DataDBHelper直接从数据库获取历史记录

上述机制确保了数据流转的高效性与一致性，避免了不必要的网络请求与数据冗余。

## 数据处理

应用能够处理STM32发送的特定格式数据：
```
Data1: [原始ADC值]
Data2: [计算的氧浓度]%
Data3: [计算的电压]V
```

数据在主界面完整显示所有类型，而图表分析专注于氧浓度数据，便于用户进行重点关注和分析。

## UI交互设计

应用遵循现代Android设计规范，提供流畅直观的交互体验：

1. **视觉反馈**：所有操作（如刷新、连接、测量）均提供即时视觉反馈
2. **动态图表**：图表数据更新时配有动画效果，使数据变化更加直观
3. **状态指示**：通过颜色编码（红/蓝）直观显示氧浓度状态
4. **操作保护**：防止用户在蓝牙未连接时执行需要连接的操作
5. **超时处理**：当操作无法在预期时间内完成时，提供友好的超时提示

## 错误处理与自动恢复

- 蓝牙连接断开自动重连：当蓝牙连接意外断开时，应用会自动尝试重新连接，最多尝试3次
- 连接状态监控：应用会持续监控蓝牙连接状态，并在状态变化时更新界面
- 操作保护：在蓝牙未连接的情况下尝试开始测量时，应用会提示用户先连接设备
- 测量状态管理：当蓝牙连接断开时，如果正在测量，应用会自动停止测量并通知用户
- 广播安全：应用内广播使用RECEIVER_NOT_EXPORTED标志，确保安全性

## 权限要求

应用需要以下权限：
- 蓝牙权限：用于扫描、连接蓝牙设备和传输数据
- 位置权限：Android 6.0及以上扫描蓝牙需要位置权限
- 存储权限：用于保存数据到设备存储

## 开发与构建说明

### 环境要求
- Android Studio 4.0+
- Java 8+
- Gradle 7.0+

### 构建步骤
1. 克隆仓库到本地
2. 在Android Studio中打开项目
3. 安装依赖（会自动进行）
4. 点击运行按钮在模拟器或实际设备上运行应用

## 注意事项

- 确保连接的蓝牙设备正确发送格式化的数据
- 对于某些设备，可能需要进行配对后才能连接
- 当前应用设计假设蓝牙设备只会发送数据而不接收命令
- 应用目前支持基本的蓝牙通信功能，可以根据实际需求进行扩展

## 项目完成情况

已完成：
- 基本UI界面与交互优化
- 蓝牙设备扫描与显示
- 蓝牙连接功能与自动重连
- 多种类型数据的实时显示
- 图表更新机制优化，支持动画效果
- 氧浓度数据的多类型图表可视化（折线图、柱状图、饼图）
- 历史记录的分类显示
- 未连接设备时的操作保护
- 数据分析与统计功能
- 安全的应用内广播通信
- 直观的视觉反馈与状态指示

尚未完成:
- 数据持久化存储优化（目前使用内存存储，应用关闭后数据会丢失）
- 设备配对功能
- 更多自定义图表设置选项
- 数据导出功能 